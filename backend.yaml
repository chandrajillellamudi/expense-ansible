- name: Configuring backend server
  hosts: backend
  become: yes
  vars:

  tasks:
   - name: disable nodejs module
     ansible.builtin.command: "dnf module disable nodejs -y"

   - name: enable nodejs 20 module
     ansible.builtin.command: "dnf module enable nodejs:20 -y"

   - name: install nodejs
     ansible.builtin.dnf:
        name: nodejs
        state: present

   - name: cerate user for backend app
     ansible.builtin.user:
       name: expense

   - name: create backend app directory
     ansible.builtin.file:
      path: /app
      state: directory

   - name: download backend app code
     ansible.builtin.get_url:
        url: " https://expense-builds.s3.us-east-1.amazonaws.com/expense-backend-v2.zip"
        dest: /tmp/backend.zip

   - name: unzip backend app code
     ansible.builtin.unarchive:
      src: /tmp/backend.zip
      dest: /app
      remote_src: yes

   - name: install backend app dependencies
     ansible.builtin.command: "npm install"
     args:
      chdir: /app 
     